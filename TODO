//todo Clean up the code, make it more readable